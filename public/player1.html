<!DOCTYPE html>
<html>
    <head>
        <title>Player 1</title>
        <meta charset="utf-8" />
        <meta name="apple-mobile-web-app-capable" content="yes">
        <script src="https://aframe.io/releases/1.1.0/aframe.min.js"></script>
    </head>

    <body>
        <a-scene background="color:rgb(0, 0, 0);" >
            <a-assets timeout="10000">
                <img id="earth_map"        src="/assets/2k_earth_daymap.jpg" crossorigin="anonymous">

                <a-asset-item id="church_model"  response-type="arraybuffer" src="/assets/church.glb"></a-asset-item>
                <a-asset-item id="playerOne_model"  response-type="arraybuffer" src="/assets/playerTwo.glb"></a-asset-item>
                
  
      
            </a-assets>

            <a-entity camera wasd-controls look-controls listener position="-11 2.5 8">
                <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; objects:.interactive"></a-entity>

                
            </a-entity>

            <a-entity id="playerOne" static-body position="4.200 1.256 -3.711" rotation="0 -161.30 0" scale="0.004 0.004 0.004"
                gltf-model="#playerOne_model"></a-entity>

           
                <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200; objects:.interactive"></a-entity>
            </a-entity>

            <a-entity id="church" static-body position="0 0 0" rotation="0 0 0" scale="1 1 1"
                gltf-model="#church_model"></a-entity>


                  <a-entity id="earth_plane" position="-10.980 2.728 5.352" rotation="-13.901 -3.4146 0.3" scale="1 1 1" visible="true">
                    <!--<a-entity geometry="primitive:plane; width:1.5; height:1.0;" material="src:#earth_map" position="0.65 0 0.01" shadow="cast:false; receive:true;"></a-entity>-->
                    <a-entity geometry="primitive:box; width:3.0; height:3.0; depth:0.1;" material="color:black;" position="0 0 -0.11" shadow></a-entity>
                    <a-entity text="value:Welcome Player 1; 
                                    color:blue; font:roboto; width:2.5; anchor:left; baseline:top; wrapCount:18;" position="-1.4 0.5 0.01" ></a-entity>
                    <a-entity text="value: make sure the green button has been changed to black. then search around for lenny. he will tell you what to do to win.;
                                    color:white; font:roboto; width:2.25; anchor: left; baseline:top; wrapCount:18;" position="-1.4 0.25 0.01" ></a-entity>
                  </a-entity>

            <!-- red button 
            <a-entity id="red_button" position="5.185 1.205 2.663">
                <a-entity class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(255, 100, 100)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>-->


            <!--buttons-->
            <a-entity id="green_button" position="5.249 1.229 2.165" visible="true">
                <a-entity class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.6;" material="color:rgb(100, 255, 100)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(0, 0, 0); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(100, 100, 100); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>

            <a-entity id="Yellow_button" position="2 1.229 0" visible="true">
                <a-entity class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.6;" material="color:rgb(255, 255, 100)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(255, 255, 0); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(255, 255, 100); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>

            <a-entity id="pink_button" position="5 1.229 0" visible="true">
                <a-entity class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.6;" material="color:rgb(255, 0, 255)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(255, 0, 255); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(0, 0, 0); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>

            <!-- blue button -->
            <a-entity id="blue_button" position="19.666 1.5666 11.255" visible="true">
                <a-entity class="button interactive" position="0 0.6 0" geometry="primitive:cylinder; radius:0.15; height:0.2;" material="color:rgb(100, 100, 255)"
                            animation__mouseenter="property:material.color; type:color; to:rgb(0, 0, 255); startEvents:mouseenter; dur:200"
                            animation__mouseleave="property:material.color; type:color; to:rgb(100, 100, 255); startEvents:mouseleave; dur:200"
                            animation__click="property:position.y; from:0.55; to:0.6; startEvents:click; dur:300" shadow></a-entity>
                <a-entity position="0 0.3 0" geometry="primitive:box; width:0.5; depth:0.5; height:0.6;" material="color:rgb(255, 255, 255)" shadow></a-entity>
            </a-entity>

            <a-entity id="speech" position="4.231 2.606 -3.794" rotation="-13.901 176.666 0.3" scale="0.2 0.15 0.5" visible="true">
                <!--<a-entity geometry="primitive:plane; width:1.5; height:1.0;" material="src:#earth_map" position="0.65 0 0.01" shadow="cast:false; receive:true;"></a-entity>-->
                <a-entity geometry="primitive:box; width:3.0; height:3.0; depth:0.1;" material="color:black;" position="0 0 -0.11" shadow></a-entity>
                <a-entity text="value:AHA! You've found me; 
                color:red; font:roboto; width:2.7; anchor:left; baseline:top; wrapCount:18;" position="-1.4 0.5 0.01" ></a-entity>
                <a-entity text="value: In order to win you have to change the background color first by clicking the blue object.;
                                    color:white; font:roboto; width:2.25; anchor: left; baseline:top; wrapCount:18;" position="-1.4 0.25 0.01" ></a-entity>
              </a-entity>
        </a-scene>

         <!-- //VERY HANDY! https://socket.io/docs/v3/emit-cheatsheet/  -->
         <script src="/socket.io/socket.io.js"></script>
         <script>
             const socket = io();
 
             socket.on('connect', (userData) => {
                 console.log('I exist!');
 
                 //put code here so that we know that socket.io has initailized ...
 
                 document.querySelector('#blue_button').querySelector('.button').addEventListener('click', function(){
                     socket.emit('blue');
                     let winnerTwo = '';
                     socket.emit('winnerTwo', winnerTwo);
                 });
                 document.querySelector('#green_button').querySelector('.button').addEventListener('click', function(){
                     socket.emit('green');
                 });
 
             });
 
             //listen to event from server
             socket.on('color_changeTwo', (data) => {
                 let colorStrTwo = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
                 console.log('color_changeTwo:' + colorStrTwo);
                 //document.body.style.backgroundColor = colorStr;
                 document.querySelector('#green_button').querySelector('.button').setAttribute('material', {color:colorStrTwo});
                 document.querySelector('#_button').querySelector('.button').setAttribute('material', {color:colorStrTwo});
             });

             socket.on('color_change', (data) => {
                 let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
                 console.log('color_change:' + colorStr);
                 //document.body.style.backgroundColor = colorStr;
                 document.querySelector('a-scene').setAttribute('background', {color:colorStr});
                
                 
            socket.on('winnerMessage', (data) => {
                console.log(data);
                    alert('player two won!') 
                }); 

                socket.on('winnerMessageTwo', (data) => {
                    console.log(data);
                    alert('player one won!')
                });


             });


         </script>
    </body>
</html>
